var e,t,n,r,s,a=require("@parcel/plugin"),c=require("path"),i=require("fs"),o=require("prettier"),l=require("less"),u=require("typescript");function d(e){return e&&e.__esModule?e.default:e}function f(e){try{return o.format(e,{parser:"less"})}catch(t){try{return o.format(e,{parser:"css"})}catch(t){return e}}}async function p(e){const t=(0,i.readFileSync)(e,"utf8");return Array.from(t.matchAll(/<style([^>]*)>([^<]+)<\/style>/gi)).map((e=>({attrs:e[1].trim(),css:f(e[2].trim())}))).shift()}async function m(e){let t=f(e);return(await d(l).render(t,{compress:!0})).css}function y(e){return`\n    setTimeout(() => {\n      const rootElement = findRootElement(this.$el);\n      const style = rootElement.querySelector("style") ?? document.createElement('style');\n      style.innerHTML = \`${e}\` + style.innerHTML;\n      rootElement?.appendChild(style);\n    }, 0);\n  `}function h(e,t){return(0,o.format)(e,{parser:t})}function v(e){try{return h(e,"typescript")}catch(e){}try{return h(e,"babel")}catch(e){}return e}function g(...e){return Array.from(e).map(v).join("\n")}function $(e){try{const t=e.replaceAll(/<[^>]+>/gi,(e=>`${e}\n`));return o.format(t,{parser:"html"})}catch(t){return e}}async function b(e,t){const n=await d(l).render(e,{filename:t});var r;return null!==(r=null==n?void 0:n.css)&&void 0!==r?r:""}function w(e){return`\n    try {\n      thisElement(this).setAttribute("data-asset-id", "${e}");\n    } catch (e) {\n    }\n  `}e=module.exports,Object.defineProperty(e,"__esModule",{value:!0,configurable:!0}),t=module.exports,n="default",r=()=>T,Object.defineProperty(t,n,{get:r,set:s,enumerable:!0,configurable:!0});var C=c.resolve(__dirname,"../src");function q(e,t){const n=v(e);return v(n.replace(/mounted((\s*\(\))|(\W*function\s*\(\)))\s*[{]\s*([^}]+\s*)[}]/g,((e,n,r,s,a)=>`mounted${n} {${g(t,a)}}`)))}async function E(e){var t;const n=null!==(t=await e.getCode())&&void 0!==t?t:"";if(n.includes("/* processed by parcel-transformer-vue-ce */"))return;const r=e.filePath,s=await p(r);if(s){const t=s.css;if(t){const c=e.id,o=s.attrs.split(" ").includes("scoped")?`[data-asset-id='${c}'] { ${t} }`:t,l=await b(o,r),d=await m(l),f=g("/* processed by parcel-transformer-vue-ce */",(a=C+"/vueInjectJs.ts",(0,u.transpile)((0,i.readFileSync)(a,"utf8"),{module:u.ModuleKind.CommonJS,target:u.ScriptTarget.ES5})),y(d),w(c));let p;p=n.replace(/<script([^>]*)>([^<]+)<\/script>/gi,((e,t,n)=>$(`<script${t}>${q(n,f)}<\/script>`))),p!=n?e.setCode(p):(p=q(n,f),p!=n&&e.setCode(p)),e.invalidateOnFileChange(r)}}var a}function j(e){var t;return null===(t=null==e?void 0:e.replace(/\s+/g," "))||void 0===t?void 0:t.trim()}async function M(e,t){const n=j(await e.getCode());if(n){e.setCode(""),e.setMap(null);const r=e.filePath;e.invalidateOnFileChange(r);const s=j(`\n      const style = document.createElement('style');\n      style.innerHTML += \`${n}\`;\n      document.head.appendChild(style);\n    `);if(s){const n={type:"js",content:s,uniqueKey:`${e.id}-js-styles`,bundleBehavior:"inline"};t.push(n)}}}const S={transform:async function({asset:e}){const t=[e],{filePath:n,type:r}=e;return n.match(/\.vue$/)&&("css"===r&&await M(e,t).catch(console.error),"vue"!=r&&"js"!=r||await E(e).catch(console.error)),n.match(/\.css$/)&&await M(e,t).catch(console.error),t}};var T=new(0,a.Transformer)(S);
//# sourceMappingURL=transformer.js.map
